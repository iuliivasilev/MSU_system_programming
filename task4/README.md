# Задание студента 209 группы Васильева Юлия.  
## Вариант задания Task4: Игровой сервер:  
## Реализация игры Bomberman. 
---
## Концепция Игры
На поле, размером 15х15 находится до 4х игроков.  
Каждый игрок имеет в своем распоряжение набор команд:  
-  Движение: up, down, left, right  
-  Установка бомбы: set_bomb  
Карта заполнена блоками, мешающими игрокам передвигаться по карте.  
От бомб окружающим их блокам наносится урон.(как блокам, так и игрокам)  
С помощью бомб игрок "расчищает" себе путь на карте.  
Выигрывает тот игрок, кто последний останется в живых.  
---
## Планы реализации:
Для аккуратного написания задания Task4 было принято решение разбить его на следующие этапы:  
**Клиент-серверная часть:**  
-  Сервер для задания Task 1 переписать на язык C++: +  
-  Изменить логику сервера с процедурного на ООП: В процессе ++(03.04.18)  
-  Написать интерфейс игры для "живого" пользователя: ++(кроме бомб)(0.04.18)(до 7.04.18)   
-  Адаптировать клиентскую часть под интерпретатор "бота":+(до 14.04.18)  
**Интерпретатор языка программирования ботов:**  
-  Лексический анализ (до 14.04.18)++(09.04.18)  
-  Синтаксический анализ (до 21.04.18)+(09.04.18)  
-  Семантический анализ (до 28.04.18)+  
**Написание автоматических игроков(ботов):+**  
-  Написание простейших ботов: по кругу;устанавливай везде бомбы+   
-  Написание усложненных ботов: охота на игрока или побег от него.+-  
**Графическое оформление игры:**  
-  Визуализация в консоли с помощью печати массива (реализация сразу).++(03.04.18)  
-  Визуализация в окне с помощью Qt. -  

---

## Механизм работы
### Сервер
До начала игры сервер подключает необходимое кол-во игроков: <=4.  
Если игроков найдено меньше или не найдено совсем, то через сервер вызывается упрощенная версия  
игры или свободные места забываются ботами.  
После начала игры все запросы на подключение запрещаются.  
Сервер принимает запросы от клиентов с помощью операции select()  
Клиенты передают через сокет серверу структуру с необходимой информацией:  
-  Тип запроса.  
-  Необходимость ответа клиенту(например, замена координат для перемещения).  
-  Номер сокета.  
После чего сервер принимает сам запрос и совершает некие действия.  
Проверка запросов осуществляется через select() и for(;;), в конце каждого цикла - обновление карты.  
После окончания игры выбирается победитель и игра завершается.  

### Клиент
Клиент находится в ожидании прихода данных от сервера и/или от игрока.  
Клиент анализирует запрос игрока и перенаправляет его(запрос) серверу,после чего получает(или нет)ответ.  
Также включена возможность использование итерпретируемого ЯП для моделирования работы игрока.

Взаимодействие клиента с ЯП ботов осуществляется через систему неименнованных каналов и параллельных процессов, с помощью команд pipe() и fork().  
В начале игры создается процесс, отвечающий за обработку программы на ЯП, который, при появлении команд для выполения сервера,  
отправляет запрос процессу клиента и, в зависимости от команды, ждёт/не ждёт ответа от него.  
Параллельно процесс клиента добавляет в мн-во файловых дескрипторов readfds ф.д канала ЯП и ожидает запроса через команду select().  
При обработке команды на клиенте, клиент решает либо отправить запрос серверу (передвижение, установка бомбы), либо самостоятельно ответить на запрос (если ЯП, например, требует выдать значение какой-либо переменной через команду Take().).  

---

### Архитектура языка программирования ##
[Лексический анализ]: https://github.com/iuliivasilev/MSU_system_programming/blob/master/task4/Task41.png
[Синтаксический анализ]: https://github.com/iuliivasilev/MSU_system_programming/blob/master/task4/Task42.png
[Лексический анализ]  
[Синтаксический анализ]  
Системные команды ЯП: Up.Down.Right.Left.Take().Setbomb.  
В ЯП реализована работа функций, циклов while, условных операторов if () {} [else] {},  
оператор выбора операции either {} {or {} }.  
Оператор вида either { } { or {} }. :  
Из возможных вариантов операторов выбирает произвольный и выполняет его.  
Реализация: при создании ПОЛИЗ'а оператора, мы вводим список всех возможных стартовых позиций операторов, описанных either.  
После заполнения списка произвольно выбираем число от 0 до размера списка. Это и есть искомый номер команды для выполнения.  
Очищаем список с конца до появления команды, при котором список имел размер выбранного нами числа.  
Значение начала этой команды заносим в ПОЛИЗ.  

---
 
#### Обновление 03.04.18
1)Реализована система обмена запросами между клиентами и сервером.  
2)Реализована проверка на ошибки ввода в клиенте и сервере.  
3)Проверка и решение критических ситуаций - во время игры отключается один игрок: + .  
4)Добавлены структуры для обмена запросами.  
5)Визуализация в консоли.  
6)Создание игрового процесса для живого игрока на стороне клиента.  
7)Частично переписан Makefile, исправлены функции классов для пространства игры.  
** Ближайшие планы: реализация "бомб" **   

---

### Обновление 09.04.18
#### Игра
1)Реализована система бомб.  
2)Появилось различие между проходимой и непроходимой территорией.  
3)Добавлена разрушимость непроходимой территории с помощью бомб.  
4)Оформлена визуализация "взрыва".  
5)Исправлены ошибки на сервере из-за "вылета" пользователя.  
6)Игра продолжается при отключении игроков.(Но как только отключается последний - выключаем сервер).  
** Ближайшие планы: организация очков, жизни игроков, определение победителя. **  
#### Язык программирования ботов ####
1)Построен лексический анализ: результат - функция get_lex(), выделяющая из файла лексему.  
2)Лексический анализ оформлен в библиотечный файл Scanner.h  
3)Начат синтаксический анализ.  
** Ближайшие планы: завершение синтаксического анализа. **   

---

### Обновление 12.04.18
#### Игра
1)Организована система начисления очков.  
2)Рассмотрена и решена ситуация нанесения урона игроку от бомбы.  
3)Введена система жизни и смерти игроков.  
4)Для игрока теперь выводятся общие результаты.  
** Ближайшие планы: определение победителя, возможность подключения игроков во время сеанса игры, 
учёт нажатия клавиш,вместо команд **  
#### Язык программирования ботов ####
1)Введены 2 типа значений: int,coord.  
2)Синтаксический анализатор завершен на >90%.  
** Ближайшие планы: создание системы доступа к полям типа coord. **   

---

### Обновление 20.04.18
#### Язык программирования ботов
1)Введён тип bool, реализована работа с данными этого типа.  
2)Реализована обработка операций сравнения,логических выражений.  
3)Введена работа с функциями.  
** Оформление семантического анализа. **   

---

### Обновление 27.04.18 
#### Язык программирования ботов
1)Завершен семантический анализ.  
2)В язык добавлены функции, их запуск, взаимодействие.  
3)Сильно изменена архитектура программы, в частности, строение Parser.  
4)Изменен ввод из файла для класса Scanner с низкоуровневого на высокоуровневый.  
** Ближайшие планы: перевод в ПОЛИЗ, перевод игры на qt **  

---

### Обновление 04.05.18
#### Язык программирования ботов
1)Реализован перевод в ПОЛИЗ.  
2)Реализован исполнитель программы с ПОЛИЗА.  
3)Добавлено системное слово "return".  
4)Добавлена семантическая обработка и перевод выражений с "return".  
5)Язык программирования ботов завершен > 95%.  
** Ближайшие планы: при выполнении языковых команд вызывать серверные функции,написание алгоритмов ботов **  

---

### Обновление 10.05.18  
#### Язык программирования ботов
1)Добавлен вызов серверных функций при выполнении языковых команд.  
2)Написаны алгоритмы игры ботов.  

#### Игра
1)Добавлен вывод победившего игрока.  
2)Изменён баланс игры, добавлено больше жизней.  
3)Введено взаимодействие клиента через программу на ЯП ботов.  

---

## Техническая реализация ##
#### Компиляция + Запуск ####
##### Сервер #####
1. make space
2. make gameserver  
3. ./server.out 
##### Клиент #####
1. make gameclient
2. ./client.out
##### **Или сокращенная компиляция + запуск** ##### 
* Сервер: make runserver   
* Клиент: 
1. make gameclient
2. ./client.out <name of file>
##### Язык программирования ботов
1. make Parser
2. ./Parser.out <имя файла>
